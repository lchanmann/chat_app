<h1><%= @chatroom.title %></h1>
<hr />
<div class="message-list">
  <ul>
    <% @chatroom.messages.each do |message| %>
      <li>
        <span class="sent-by"><%= message.sent_by %>: </span>
        <span class="content"><%= message.content %></span>
      </li>
    <% end %>
  </ul>
</div>
<hr />
<div class="message-composer">
  Messages: <br />
  <textarea id="message" rows="3"></textarea> <br />
  <button id="btnSend">Send</button>
</div>

<script>
  document.addEventListener('turbolinks:load', () => {
    const $messageList = document.getElementsByClassName('message-list')[0];
    const $ul = $messageList.getElementsByTagName('ul')[0];

    // subscribe to chatroom
    App.subscribe(<%= @chatroom.id %>, function(data) {
      const { sent_by, content } = data;
      const $li = document.createElement('li');

      $li.innerText = `${sent_by}: ${content}`;
      $ul.append($li);
    });

    // bind and handle btnSend.click event
    const $btnSend = document.getElementById('btnSend');
    $btnSend.onclick = function() {
      const $message = document.getElementById('message');
      App.chat.send_message({ message: { content: $message.value } });
    }
  });
</script>
